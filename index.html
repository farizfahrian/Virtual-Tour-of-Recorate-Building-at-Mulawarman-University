<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <title>Panolens.js panorama infospot</title>
</head>

<body>

    <div id="container">
        <div class="control">
            <select class="location-dropdown control-item" name="language" id="language">
                <option value="panorama1" selected>Panorama 1</option>
                <option value="panorama2">Panorama 2</option>
                <option value="panorama3">Panorama 3</option>
                <option value="panorama4">Panorama 4</option>
            </select>
            <div class="location-container control-item">
                <p class="room-location">Ruangan Humas</p>
                <p class="floor-location">Lt.1 Gedung A</p>
            </div>
            <div class="icon-container control-item">
                <img id="controlButton" class="button" src="assets/icons/gyroscope.svg" style="cursor: pointer;"></img>
                <img id="controlButton2" class="button" src="assets/icons/rotate.svg" style="cursor: pointer;">
                </img>
            </div>
        </div>
    </div>

    <script src="build/three.min.js"></script>
    <script src="build/panolens.min.js"></script>

    <script>

        var panorama1, panorama2, panorama3, panorama4, viewer, container, infospot, controlButton, videoButton;

        var controlIndex = PANOLENS.CONTROLS.ORBIT;
        var modeIndex = 0;
        var autoRotate = false;

        container = document.querySelector('#container');

        const selectElement = document.querySelector('#language');

        controlButton = document.querySelector('#controlButton');

        viewer = new PANOLENS.Viewer({ container: container, autoHideInfospot: false, autoRotateActivationDuration: 3500, autoRotateSpeed: 1, controlBar: false });
        panorama1 = new PANOLENS.ImagePanorama('assets/images/tunnel.jpg');
        panorama2 = new PANOLENS.ImagePanorama('assets/images/interior.jpeg');
        panorama3 = new PANOLENS.ImagePanorama('assets/images/kitchen.jpeg');
        panorama4 = new PANOLENS.ImagePanorama('assets/images/room.jpeg');

        infospot = new PANOLENS.Infospot(500, PANOLENS.DataImage.Info);
        infospot.position.set(-100, -500, -7000);

        infospot.addEventListener('click', function () {
            viewer.setPanorama(panorama3);
        });

        panorama1.add(infospot);


        infospot2 = new PANOLENS.Infospot(500, PANOLENS.DataImage.Info);
        infospot2.position.set(800, -500, -7000);

        infospot2.addEventListener('click', function () {
            viewer.setPanorama(panorama1);
        });


        panorama2.add(infospot2);

        viewer.add(panorama1, panorama2, panorama3, panorama4);

        function onButtonClick(targetPanorama) {
            // bar.classList.remove('hide');
            viewer.setPanorama(targetPanorama);
        }

        selectElement.addEventListener('change', (event) => {
            const result = event.target.value;
            if (result === 'panorama1') {
                onButtonClick(panorama1);
                alert('panorama1');
            } else if (result === 'panorama2') {
                onButtonClick(panorama2);
                alert('panorama2');
            } else if (result === 'panorama3') {
                onButtonClick(panorama3);
            } else if (result === 'panorama4') {
                onButtonClick(panorama4);
            }
        });


        $('#controlButton').on('click', function (event) {
            controlIndex = controlIndex >= 1 ? 0 : controlIndex + 1;

            switch (controlIndex) {

                case 0: viewer.enableControl(PANOLENS.CONTROLS.ORBIT); break;
                case 1: viewer.enableControl(PANOLENS.CONTROLS.DEVICEORIENTATION); break;
                default: break;

            }
        });

        $('#controlButton2').on('click', function (event) {
            // alert(autoRotate);
            if (autoRotate === false) {
                viewer.options.autoRotate = true;
                viewer.OrbitControls.autoRotate = true;
                autoRotate = true;
            } else {
                clearTimeout(viewer.autoRotateRequestId);
                viewer.options.autoRotate = false;
                viewer.OrbitControls.autoRotate = false;
                autoRotate = false;
            }
        });

        $('#container').on('mousewheel', function (e) {
            if (e.originalEvent.wheelDelta / 120 > 0) {
                var currentZoom = viewer.camera.fov;
                var newZoom = currentZoom - 5;
                if (newZoom < 30) newZoom = 30;
                viewer.setCameraFov(newZoom);
                console.log('scrolling up !');
            }
            else {
                var currentZoom = viewer.camera.fov;
                var newZoom = currentZoom + 5;
                if (newZoom > 110) newZoom = 110;
                viewer.setCameraFov(newZoom);
                console.log('scrolling down !');
            }
        })


    </script>

</body>

</html>